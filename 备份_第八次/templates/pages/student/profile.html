<!-- templates/pages/student/profile.html - Complete Update -->
{% extends 'base/base.html' %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/student.css') }}">
{% endblock %}

{% block title %}Profile - Komodo Hub{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Profile</h1>
        <p>Manage your account information and personal settings</p>
    </div>

    <div class="profile-content">
        <!-- Basic Information Card -->
        <div class="content-section">
            <h2 class="section-title">Basic Information</h2>
            <div class="profile-card">
                <div class="profile-avatar-large">
                    {% if student_info['avatar'] %}
                        <img src="{{ student_info['avatar'] }}" alt="Avatar">
                    {% else %}
                        <i class="fas fa-user-circle"></i>
                    {% endif %}
                </div>
                <div class="profile-details">
                    <div class="profile-item">
                        <span class="label">Full Name:</span>
                        <span class="value">{{ student_info['full_name'] }}</span>
                    </div>
                    <div class="profile-item">
                        <span class="label">Email:</span>
                        <span class="value">{{ student_info['username'] }}</span>
                    </div>
                    <div class="profile-item">
                        <span class="label">Student ID:</span>
                        <span class="value">{{ student_info['student_id'] or 'Not set' }}</span>
                    </div>
                    <div class="profile-item">
                        <span class="label">Grade:</span>
                        <span class="value">{{ student_info['grade'] or 'Not set' }}</span>
                    </div>
                    <div class="profile-item">
                        <span class="label">Registration Date:</span>
                        <span class="value">{{ student_info['created_at'][:10] }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Avatar Selection -->
        <div class="content-section">
            <h2 class="section-title">Choose Avatar</h2>
            <form method="POST" class="avatar-form">
                <div class="avatar-selection">
                    {% for avatar in avatars %}
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="{{ avatar }}"
                               {% if student_info['avatar'] == avatar %}checked{% endif %}>
                        <div class="avatar-preview">
                            <img src="{{ avatar }}" alt="Avatar {{ loop.index }}">
                        </div>
                    </label>
                    {% endfor %}
                </div>
                <button type="submit" name="update_avatar" class="btn btn-primary">Update Avatar</button>
            </form>
        </div>

        <!-- Profile Update Form -->
        <div class="content-section">
            <h2 class="section-title">Update Personal Information</h2>
            <form method="POST" class="profile-form">
                <div class="form-group">
                    <label for="full_name">Full Name:</label>
                    <input type="text" id="full_name" name="full_name" value="{{ student_info['full_name'] }}" required>
                </div>
                <div class="form-group">
                    <label for="grade">Grade:</label>
                    <input type="text" id="grade" name="grade" value="{{ student_info['grade'] or '' }}" placeholder="e.g., Grade 3">
                </div>
                <button type="submit" name="update_profile" class="btn btn-primary">Update Profile</button>
            </form>
        </div>

        <!-- Change Password Form -->
        <div class="content-section">
            <h2 class="section-title">Change Password</h2>
            <form method="POST" class="password-form">
                <div class="form-group">
                    <label for="current_password">Current Password:</label>
                    <input type="password" id="current_password" name="current_password" required>
                </div>
                <div class="form-group">
                    <label for="new_password">New Password:</label>
                    <input type="password" id="new_password" name="new_password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirm_password">Confirm New Password:</label>
                    <input type="password" id="confirm_password" name="confirm_password" required minlength="6">
                </div>
                <button type="submit" name="change_password" class="btn btn-primary">Change Password</button>
            </form>
        </div>

        <!-- Message Display -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
</div>
{% endblock %}