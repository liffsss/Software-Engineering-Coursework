
{% extends 'base/base.html' %}

{% block title %}Community Organization Panel - Komodo Hub{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/community.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Community Organization Dashboard</h1>
        <p>Welcome back, {{ username }}!</p>
        {% if org_name %}
        <div class="org-info">
            <strong>Organization Name:</strong> {{ org_name }} |
            <strong>Contact Person:</strong> {{ contact_person }}
        </div>
        {% endif %}
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-info">
                <h3>{{ article_count }}</h3>
                <p>Published Articles</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3>{{ member_count }}</h3>
                <p>Community Members</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar"></i>
            </div>
            <div class="stat-info">
                <h3>{{ event_count }}</h3>
                <p>Events</p>
            </div>
        </div>
    </div>

    <div class="dashboard-content">
        <h2 class="section-title">Community Features</h2>
        <div class="dashboard-grid">
            {% from "components/dashboard_card.html" import dashboard_card %}

            {{ dashboard_card(
                icon="fas fa-edit",
                title="Article Management",
                description="Publish and manage your articles",
                button_text="Manage Articles",
                link=url_for('community.manage_articles')
            ) }}

            {{ dashboard_card(
                icon="fas fa-users",
                title="Community Members",
                description="Manage community member information",
                button_text="View Members",
                link=url_for('community.manage_members')
            ) }}

            {{ dashboard_card(
                icon="fas fa-calendar",
                title="Event Management",
                description="Create and manage community events",
                button_text="Manage Events",
                link=url_for('community.manage_events')
            ) }}

            {{ dashboard_card(
                icon="fas fa-user-cog",
                title="Organization Profile",
                description="Manage basic organization information",
                button_text="Edit Profile",
                link=url_for('community.profile')
            ) }}
        </div>
    </div>

    <!-- Latest Events -->
    <div class="events-section">
        <div class="section-header">
            <h2 class="section-title">Latest Events</h2>
            <a href="{{ url_for('community.manage_events') }}" class="btn btn-outline">
                Manage All Events
            </a>
        </div>

        <div class="events-grid">
            {% for event in events %}
            <div class="event-card">
                <div class="event-header">
                    <h3>{{ event.title }}</h3>
                    <span class="event-status status-{{ event.status }}">
                        {% if event.status == 'upcoming' %}Upcoming
                        {% elif event.status == 'ongoing' %}Ongoing
                        {% elif event.status == 'completed' %}Completed
                        {% elif event.status == 'cancelled' %}Cancelled
                        {% else %}{{ event.status }}{% endif %}
                    </span>
                </div>
                <p class="event-description">{{ event.description[:100] }}{% if event.description|length > 100 %}...{% endif %}</p>
                <div class="event-details">
                    <div class="event-detail">
                        <i class="fas fa-calendar"></i>
                        <span>{{ event.event_date }}</span>
                        {% if event.event_time %}
                        <span>{{ event.event_time }}</span>
                        {% endif %}
                    </div>
                    {% if event.location %}
                    <div class="event-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ event.location }}</span>
                    </div>
                    {% endif %}
                    <div class="event-detail">
                        <i class="fas fa-users"></i>
                        <span>Participants: {{ event.participant_count or 0 }}</span>
                        {% if event.max_participants %}
                        <span>/ {{ event.max_participants }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="event-actions">
                    <a href="{{ url_for('community.edit_event_route', event_id=event.id) }}" class="btn btn-secondary btn-sm">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <form action="{{ url_for('community.delete_event_route', event_id=event.id) }}" method="post" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this event?')">
                        <button type="submit" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="no-events">
                <div class="empty-state">
                    <i class="fas fa-calendar-alt fa-2x"></i>
                    <p>No events to display.</p>
                    <a href="{{ url_for('community.create_event_route') }}" class="btn btn-primary">
                        Create First Event
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Articles List -->
    <div class="articles-section">
        <div class="section-header">
            <h2 class="section-title">Latest Articles</h2>
            <a href="{{ url_for('community.manage_articles') }}" class="btn btn-outline">
                Manage All Articles
            </a>
        </div>

        <div class="articles-grid">
            {% for article in articles %}
                {% from "components/article_card.html" import article_card %}
                {{ article_card(article) }}
            {% else %}
            <div class="no-articles">
                <div class="empty-state">
                    <i class="fas fa-file-alt fa-2x"></i>
                    <p>No articles to display.</p>
                    <a href="{{ url_for('community.create_article') }}" class="btn btn-primary">
                        Publish First Article
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
